#
# Make for libGOLPTP
#

include ../scripts/makefile.def

# artifact NAME
ART_NAME=libgolptp
ART_AR=$(ART_NAME)$(DLLEXT)
ART_SO=$(ART_NAME)$(SLLEXT)

# artifact objects
OBJS = \
$(TO_OBJ)/tp_1st.o \
$(TO_OBJ)/tp_2nd.o


# artifact dependencies that auto-generated by MAKE
C_DEPS=$(OBJS:.o=.d)

ifneq ($(MAKECMDGOALS),clean)
ifneq ($(strip $(C_DEPS)),)
-include $(C_DEPS)
endif
endif


# this atrifact
TARGETS=$(TO_LIB)/$(LIBGOLPTP_AR) $(TO_LIB)/$(LIBGOLPTP_SO)


# search path for source codes of $TARGETS, and
# use space character to separate two path
VPATH=$(SRCTOP)/tp

# options to compiler for $TARGETS
# -I for header files' search path
# -D for define one MACRO
MYDEF=

# options to linker for $TARGETS
# -L for library search path
# -l for one library to be linked
MYLIB=-L$(TO_LIB) -l$(LIBGOLP) -l$(LIBLOG) $(ORALIBS) -dl -lpthead -lm -lc


all: $(TARGETS)

$(TO_LIB)/$(LIBGOLPTP_AR): $(OBJS)
	@$(ECHO) 'Building target: $@'
	@$(AR) $(AROPT) $@ $(OBJS)
	@$(ECHO) 'Finished building target: $@'
	@$(ECHO) ' '

$(TO_LIB)/$(LIBGOLPTP_SO): $(OBJS)
	@$(ECHO) 'Building target: $@'
	$(LD) -o $@ $(SOFLAG) $(OBJS) $(MYLIB)
	@$(ECHO) 'Finished building target: $@'
	@$(ECHO) ' '


$(TO_OBJ)/%.o: %.cpp
	$(CC) -c -o $@ $(CFLAGS) $(MYDEF) $(SYSDEF) -MMD -MP -MF"$(@:%.o=%.d)" -MT"$(@:%.o=%.d)" $<
	@$(ECHO) ' '


clean:
	-$(RM) $(OBJS) $(C_DEPS) $(TARGETS)
	-@echo ' '

mostlyclean:
	-$(RM) $(OBJS) $(C_DEPS)
	-@$(ECHO) ' '

install: $(TARGETS)
	@$(CP) $(TO_LIB)/$(LIBGOLPTP_SO) $(INSTLIBDIR)/
	@$(CP) $(TO_LIB)/$(LIBGOLPTP_AR) $(INSTLIBDIR)/
	@$(ECHO) 'The $(ART_NAME) has installed into $(INSTLIBDIR) from $(TO_LIB).'
	@$(ECHO) ' '

